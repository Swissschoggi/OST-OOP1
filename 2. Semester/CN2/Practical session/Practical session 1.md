# OSPF

OSPF gathers llink state information from available routers and makes a topology map of the network.  
In **IPv4** the version used is **OSPF version 2**, for **IPv6** its **OSPF version 3**.

OSPF divides a network into sub-domains known as **areas**.  
Area ID 0 is for the **Core area** also known as the **Backbone Area**.

---

## Types of Routers

Routers are classified into 4 different types:

- **Internal Routers**  
  Router with all directly connected networks belonging to the same area, running a copy of the basic algorithm.

- **Area Border Routers (ABR)**  
  Router that attaches to multiple areas, runs multiple copies of the basic algorithm, one copy for each area.

- **Backbone Routers**  
  Router that has interfaces connected to the backbone area.

- **AS Boundary Routers (ASBR)**  
  Router that exchange information with other Autonomous Systems (AS). Advertises external routing information throughout the network.

There can be multiple Bakcbone routers.

---

## Types of Networks

- **Point to point networks**  
  Connecting a pair of routers directly.

- **Broadcast networks**  
  LANs where all routers can receive a single transmitted packet. There is a Designated Router (DR) and a Backup Designated Router (BDR). Highest Router-ID is DR and second highest is BDR

- **Non-Broadcast multi-access networks**  
  where more than two routers without broadcast capability. Needs extra configuration for OSPF. Also elects DR and BDR.

- **Point-to-multipoint networks**  
  Also Non-Broadcast multi-access networks but with a OSPF mode similar to point-to-point links.

---

## Virtual Links

**Area 0 has to be contiguous** meaning that if a backbone area is split due to a link failure a virtual link is used to tunnel through a non-backbone area.

**A non-backbone area has to be connected to the backbone area**, there are transit areas that connect an area to the backbone area.

---

## Link State Advertisement types

OSPF floods routing information.

- **Router LSA (Type Code = 1)**  
  most basic Link state advertisement. Generated by every router that lists all the routers outgoing interfaces. For each interface the stat and cost are included. Flooding only occurs in the Area the originated in.

- **Network LSA (Type Code = 2)**  
  A Network LSA represents a LAN. All attached routers and the DR are listed. flooding only occurs in the Area the originated in.

- **Network Summary LSA (Type Code = 3)**  
  Area Border Routers generate these LSAs and are used to advertise outside-area destinations. flooding into all areas and not totally stubby.

- **AS External LSA (Type Code = 5)**  
  only AS Boundary Routers send these to advertise external Destinations and flood them to all areas and are neither sub nor totally stubby.

---

## Flooding

- **implicit acknowledgment**  
  duplicate of the LSA as an update is sent back to the router from which it received the update.

- **explicit acknowledgment**  
  receiving router sends a link state acknowledgment packet on receiving a link state update.

LSA are always retransmitted in Unicast, on a periodic basis until an acknowledgement is received.  
A router floods all its LSAs every 30 Minutes.

As OSPF is using Dijsktras algorithm the Link State Database (LSDB) always needs to be synchronized for the right information.

---

# Packet Format

1. Type 1: Hello  
2. Type 2: database description  
3. Type 3: link state request  
4. Type 4: link state update  
5. Type 5: link state acknowledgment  

---

## Hello Packet

Used to establish and maintain links.

## Database Description Packet

Summary of all LSAs that the neighboring router has in its LSDB.

## Link State Request Packet

Used to pull information, LSAs that are not in the LSDB are requested from the router.

## Link State Update Packet

Answer to the [[Practical session 1#Link State Request Packet]]

## Link State Acknowledgement Packet

Each newly received LSA must be acknowledged, by sending this packet. Multiple LSAs can be sent using this.

---

# Sub-Protocols

## Hello Protocol

On initialization used to establish neighbors and agree on several parameters.  
Used to keep connectivity alive if not received after a before agreed upon time the router is assumed dead.

## Database Synchronization Process

used to optimize the sending of Link sate advertisements.  
A master-Slave relationship is established to find out who sends the packets, highest Router-ID is master.

---

# Routing Computation and Equal-Cost MultiPath

LSAs type 1 and 2 are flooded for every router to build the LSDB with identical information.

## ECMP

Equal cost multipath means that two paths have the same lowest cost.

---

## Stub areas and stub networks

- **Stub Area**  
  area where information about external routes is not sent. The Area border router in this area creates a default route.

- **Not-so-stubby-area**  
  A stub area that can import external routes.

- **totally stubby area**  
  Uses a default route for all destinations outside this area.

- **totally not-so-stubby area**  
  uses a default route for all destinations outside this area, but still allows the injection of external routes.

---

## Cost calculation
Reference bandwith can be found with `do show ip ospf`
and the cost is calculated with $cost={b_{ref}\over b_{link}}={\text{reference badwith}\over\text{actual bandwith}}$ 